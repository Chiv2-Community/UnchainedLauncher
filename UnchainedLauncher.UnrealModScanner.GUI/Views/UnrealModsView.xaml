<UserControl x:Class="UnchainedLauncher.UnrealModScanner.GUI.Views.UnrealModsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:models="clr-namespace:UnchainedLauncher.UnrealModScanner.Models;assembly=UnchainedLauncher.UnrealModScanner"
             xmlns:viewModels="clr-namespace:UnchainedLauncher.UnrealModScanner.GUI.ViewModels"
             xmlns:guimodels="clr-namespace:UnchainedLauncher.UnrealModScanner.GUI.ViewModels"
             xmlns:nodes="clr-namespace:UnchainedLauncher.UnrealModScanner.GUI.ViewModels.Nodes"
             xmlns:models1="clr-namespace:UnrealModScanner.Models;assembly=UnchainedLauncher.UnrealModScanner"
             xmlns:Scg="clr-namespace:System.Collections;assembly=System.Runtime"
             xmlns:System="clr-namespace:System;assembly=System.Runtime"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance Type=viewModels:ModScanTabViewModel, IsDesignTimeCreatable=True}">
	<UserControl.Resources>
		<BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <nodes:PropertyFilterConverter x:Key="PropFilter" />
	</UserControl.Resources>
    <DockPanel>
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,10">
			<StackPanel Orientation="Horizontal">
				<Button Content="Scan"
						Click="Scan_UnrealMods_Click"
						IsEnabled="{Binding ModScannerVM.IsNotScanning, 
                    RelativeSource={RelativeSource AncestorType=UserControl}}" />
                
                <Button Content="Save Config"
						Click="Save_UnrealMods_Config_Click"
						IsEnabled="{Binding ModScannerVM.IsNotScanning, 
                    RelativeSource={RelativeSource AncestorType=UserControl}}" />

                <Button Content="Load Config"
						Click="Load_UnrealMods_Config_Click"
						IsEnabled="{Binding ModScannerVM.IsNotScanning, 
                    RelativeSource={RelativeSource AncestorType=UserControl}}" />

                <Button Content="Export"
                        Click="Export_UnrealMods_Click"
                        IsEnabled="{Binding ModScannerVM.IsNotScanning, 
                    RelativeSource={RelativeSource AncestorType=UserControl}}" />

                <Button Content="Export Manifest"
                        Click="Export_UnrealMods_Manifest_Click"
                        IsEnabled="{Binding ModScannerVM.IsNotScanning, 
                    RelativeSource={RelativeSource AncestorType=UserControl}}" />

				<Button Content="Collapse All"
						Click="Collapse_UnrealMods_Click"
						IsEnabled="{Binding ModScannerVM.IsNotScanning, 
                    RelativeSource={RelativeSource AncestorType=UserControl}}" />
				<ProgressBar Minimum="0"
                 Maximum="100"
                 Value="{Binding ModScannerVM.ScanProgress, RelativeSource={RelativeSource AncestorType=UserControl}}"
                 Height="20"
                 Margin="5"
				 Width="500"			 
                 Visibility="{Binding ModScannerVM.IsScanning, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}"/>
			</StackPanel>
        </StackPanel>

        <!-- <TreeView ItemsSource="{Binding viewModels:ModScanTabVM.ResultsVisual.Results}"> -->
        <!-- <TreeView ItemsSource="{Binding ResultsVisual.Children}"> -->
        <TreeView ItemsSource="{Binding ModScannerVM.ResultsVisual.Children, RelativeSource={RelativeSource AncestorType=UserControl}}">
            <TreeView.Resources>
                <Style TargetType="TreeViewItem">
                    <Setter Property="Foreground" Value="Black"/>
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                </Style>

                <!-- <DataTemplate DataType="{x:Type nodes:ModTreeNode}"> -->
                <!--     <StackPanel Margin="10,2,0,4"> -->
                <!--         <TextBlock><Run Text="Mod Name: "/><Run Text="{Binding Blueprint.ModName}"/></TextBlock> -->
                <!--         <TextBlock><Run Text="Version: "/><Run Text="{Binding Blueprint.Version}"/></TextBlock> -->
                <!--         <TextBlock><Run Text="Author: "/><Run Text="{Binding Blueprint.Author}"/></TextBlock> -->
                <!--         <TextBlock><Run Text="Clientside: "/><Run Text="{Binding Blueprint.IsClientSide}"/></TextBlock> -->
                <!--     </StackPanel> -->
                <!-- </DataTemplate> -->
                <DataTemplate DataType="{x:Type nodes:ModTreeNode}">
                    <StackPanel Margin="10,2,0,4">
                        <!-- <TextBlock><Run Text="Mod Name: "/><Run Text="{Binding Blueprint.ModName}"/></TextBlock> -->
                        <!-- <TextBlock><Run Text="Version: "/><Run Text="{Binding Blueprint.Version}"/></TextBlock> -->
                        <!-- <TextBlock><Run Text="Author: "/><Run Text="{Binding Blueprint.Author}"/></TextBlock> -->
                        <!-- <TextBlock><Run Text="Clientside: "/><Run Text="{Binding Blueprint.IsClientSide}"/></TextBlock> -->

                        <ItemsControl ItemsSource="{Binding Blueprint.Properties}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                        <Run Text="{Binding Key, Mode=OneWay, StringFormat='{}{0}: '}" FontWeight="SemiBold"/>
                                        <Run Text="{Binding Value, Mode=OneWay}"/>
                                    </TextBlock>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </DataTemplate>
                
                
                <!-- <DataTemplate DataType="{x:Type nodes:MapTreeNode}"> -->
                <!--     <StackPanel Margin="10,2,0,4"> -->
                <!--         ~1~ <TextBlock><Run Text="Mod Name: "/><Run Text="{Binding Blueprint.ModName}"/></TextBlock> @1@ -->
                <!--         ~1~ <TextBlock><Run Text="Version: "/><Run Text="{Binding Blueprint.Version}"/></TextBlock> @1@ -->
                <!--         ~1~ <TextBlock><Run Text="Author: "/><Run Text="{Binding Blueprint.Author}"/></TextBlock> @1@ -->
                <!--         ~1~ <TextBlock><Run Text="Clientside: "/><Run Text="{Binding Blueprint.IsClientSide}"/></TextBlock> @1@ -->
                <!-- -->
                <!--         <ItemsControl ItemsSource="{Binding Map.Settings, Converter={StaticResource PropFilter}}"> -->
                <!--             <ItemsControl.ItemTemplate> -->
                <!--                 <DataTemplate> -->
                <!--                     <TextBlock Margin="5,0,0,0"> -->
                <!--                         <Run Text="{Binding Key, Mode=OneWay, StringFormat='{}{0}: '}" FontWeight="Bold" Foreground="Gray"/> -->
                <!--                         <Run Text="{Binding Value, Mode=OneWay}"/> -->
                <!--                     </TextBlock> -->
                <!--                 </DataTemplate> -->
                <!--             </ItemsControl.ItemTemplate> -->
                <!--         </ItemsControl> -->
                <!--     </StackPanel> -->
                <!-- </DataTemplate> -->
                

                <DataTemplate x:Key="DynamicPropertyTemplate">
                    <StackPanel Margin="5,0,0,2">
                        <ContentControl Content="{Binding Value, Mode=OneWay}">
                            <ContentControl.Resources>
                                <DataTemplate DataType="{x:Type Scg:IDictionary}">
                                    <Expander IsExpanded="True" Margin="0,2,0,5">
                                        <Expander.Header>
                                            <TextBlock Text="{Binding DataContext.Key, RelativeSource={RelativeSource AncestorType=ContentControl}, Mode=OneWay}" 
                                                       FontWeight="Bold"/>
                                        </Expander.Header>
                                        <ItemsControl ItemsSource="{Binding}" 
                                                      ItemTemplate="{StaticResource DynamicPropertyTemplate}" 
                                                      Margin="15,0,0,0"/>
                                    </Expander>
                                </DataTemplate>

                                <DataTemplate DataType="{x:Type System:String}">
                                    <TextBlock>
                                        <Run Text="{Binding DataContext.Key, RelativeSource={RelativeSource AncestorType=ContentControl}, Mode=OneWay, StringFormat='{}{0}: '}" 
                                             FontWeight="SemiBold" Foreground="DarkGray"/>
                                        <Run Text="{Binding Mode=OneWay}"/>
                                    </TextBlock>
                                </DataTemplate>

                                <DataTemplate DataType="{x:Type System:ValueType}">
                                    <TextBlock>
                                        <Run Text="{Binding DataContext.Key, RelativeSource={RelativeSource AncestorType=ContentControl}, Mode=OneWay, StringFormat='{}{0}: '}" 
                                             FontWeight="SemiBold" Foreground="DarkGray"/>
                                        <Run Text="{Binding Mode=OneWay}"/>
                                    </TextBlock>
                                </DataTemplate>
                            </ContentControl.Resources>
                        </ContentControl>
                    </StackPanel>
                </DataTemplate>
                
                <DataTemplate DataType="{x:Type nodes:MapTreeNode}">
                    <StackPanel Margin="10,2,0,4">
                        <Separator Margin="0,5"/>
                        <TextBlock Text="Maps" FontWeight="Bold" FontSize="14"/>
                        <ItemsControl ItemsSource="{Binding Map.Settings}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="Gray" BorderThickness="1" Margin="0,5" Padding="5">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Key}" Foreground="SkyBlue" FontSize="10"/>
                            
                                            <ItemsControl ItemsSource="{Binding Value, Converter={StaticResource PropFilter}}" 
                                                          ItemTemplate="{StaticResource DynamicPropertyTemplate}"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </DataTemplate>
                
                

                <DataTemplate DataType="{x:Type nodes:AssetReplacementTreeNode}">
                    <StackPanel Margin="10,2,0,4">
                        <TextBlock><Run Text="Asset: "/><Run Text="{Binding Replacement.AssetPath}"/></TextBlock>
                        <TextBlock><Run Text="Class: "/><Run Text="{Binding Replacement.ClassName}"/></TextBlock>
                    </StackPanel>
                </DataTemplate>

                <HierarchicalDataTemplate DataType="{x:Type nodes:PakGroupNode}" ItemsSource="{Binding Children}">
                    <TextBlock Text="{Binding Title}" FontWeight="Bold" FontSize="14" Foreground="Black"/>
                </HierarchicalDataTemplate>

                <HierarchicalDataTemplate DataType="{x:Type nodes:PakResultWrapperNode}" ItemsSource="{Binding Children}">
                    <StackPanel Orientation="Horizontal">
                        <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <TextBlock FontWeight="Bold" FontSize="14" Foreground="Black">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding PakPathExpanded}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsExpanded, RelativeSource={RelativeSource AncestorType=TreeViewItem}}" Value="True">
                                            <Setter Property="Text" Value="{Binding PakPathCollapsed}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </HierarchicalDataTemplate>
            </TreeView.Resources>
        </TreeView>
    </DockPanel>
</UserControl>