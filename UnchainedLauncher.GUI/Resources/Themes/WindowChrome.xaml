<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
                    xmlns:views="clr-namespace:UnchainedLauncher.GUI.Views">
    <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />

    <Style x:Key="UnchainedChrome" TargetType="views:UnchainedWindow">
        <Setter Property="WindowStyle" Value="None" />
        <Setter Property="ResizeMode" Value="CanResize" />
        <Setter Property="AllowsTransparency" Value="False" />
        <Setter Property="Background" Value="{DynamicResource Brush.Background}" />
        <Setter Property="Foreground" Value="{DynamicResource Brush.TextPrimary}" />
        <Setter Property="shell:WindowChrome.WindowChrome">
            <Setter.Value>
                <shell:WindowChrome
                    CaptionHeight="32"
                    CornerRadius="0"
                    GlassFrameThickness="0"
                    ResizeBorderThickness="6"
                    UseAeroCaptionButtons="False" />
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="views:UnchainedWindow">
                    <Grid Background="{TemplateBinding Background}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="32" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Title bar (32px caption area) -->
                        <Grid Grid.Row="0" Background="{TemplateBinding Background}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- Optional window title on the left -->
                            <TextBlock Grid.Column="0"
                                       Margin="12,0,0,0"
                                       VerticalAlignment="Center"
                                       Text="{TemplateBinding Title}"
                                       Foreground="{TemplateBinding Foreground}"
                                       Visibility="{TemplateBinding ShowWindowTitle, Converter={StaticResource BoolToVisibilityConverter}}"
                                       Opacity="0.85" />

                            <!-- Window buttons on the right -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <ToggleButton Style="{DynamicResource ToggleButton.TitleBar}"
                                              Visibility="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ShowThemeToggle, Converter={StaticResource BoolToVisibilityConverter}}"
                                              IsChecked="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ThemeToggleContext.UseLightTheme, Mode=TwoWay}"
                                              ToolTip="Toggle light/dark theme"
                                              shell:WindowChrome.IsHitTestVisibleInChrome="True" />
                                <Button Style="{DynamicResource Button.TitleBar.Minimize}"
                                        Command="{x:Static SystemCommands.MinimizeWindowCommand}"
                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                        ToolTip="Minimize"
                                        shell:WindowChrome.IsHitTestVisibleInChrome="True">
                                    <TextBlock Text="—" FontSize="12" />
                                </Button>
                                <Button Style="{DynamicResource Button.TitleBar.Close}"
                                        Command="{x:Static SystemCommands.CloseWindowCommand}"
                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                        ToolTip="Close"
                                        shell:WindowChrome.IsHitTestVisibleInChrome="True">
                                    <TextBlock Text="×" FontSize="14" />
                                </Button>
                            </StackPanel>
                        </Grid>

                        <!-- Window content -->
                        <Border Grid.Row="1" Background="{TemplateBinding Background}">
                            <ContentPresenter />
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Title bar buttons (flat, small, hover states) -->
    <Style x:Key="Button.TitleBar" TargetType="Button" BasedOn="{StaticResource Button.Light}">
        <Setter Property="Width" Value="34" />
        <Setter Property="Height" Value="26" />
        <Setter Property="Padding" Value="0" />
        <Setter Property="Margin" Value="0" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderBrush" Value="Transparent" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="bd"
                            CornerRadius="0"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="0">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background"
                                    Value="{DynamicResource Brush.LightTransparent}" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="bd" Property="Opacity" Value="0.9" />
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="bd" Property="Opacity" Value="0.5" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="ToggleButton.TitleBar" TargetType="ToggleButton">
        <Setter Property="Width" Value="34" />
        <Setter Property="Height" Value="26" />
        <Setter Property="Padding" Value="0" />
        <Setter Property="Margin" Value="0" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderBrush" Value="Transparent" />
        <Setter Property="Foreground" Value="{DynamicResource Brush.TextPrimary}" />
        <Setter Property="Content" Value="🌙" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToggleButton">
                    <Border x:Name="bd"
                            CornerRadius="0"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="0">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background"
                                    Value="{DynamicResource Brush.LightTransparent}" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="bd" Property="Opacity" Value="0.9" />
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="bd" Property="Opacity" Value="0.5" />
                        </Trigger>
                        <Trigger Property="IsChecked" Value="True">
                            <Setter Property="Content" Value="☀" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="Button.TitleBar.Close" TargetType="Button" BasedOn="{StaticResource Button.TitleBar}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="bd"
                            Background="Transparent"
                            BorderBrush="Transparent">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="{DynamicResource Brush.Danger}" />
                            <Setter Property="Foreground" Value="{DynamicResource Brush.Light}" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="bd" Property="Opacity" Value="0.9" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Dedicated minimize button style with clearer hover (placed after Button.TitleBar to satisfy StaticResource resolution) -->
    <Style x:Key="Button.TitleBar.Minimize" TargetType="Button" BasedOn="{StaticResource Button.TitleBar}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="bd"
                            Background="Transparent"
                            BorderBrush="Transparent">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="{DynamicResource Brush.PrimaryHover}" />
                            <Setter Property="Foreground" Value="{DynamicResource Brush.Light}" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="bd" Property="Opacity" Value="0.9" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>